# Mac 메뉴바 앱 계획

## 목표
- 메뉴바 상태 아이콘으로 “현재 사용률”과 “리셋까지 남은 시간”을 실시간 표시.
- Claude Code `/status` 인터랙티브 출력을 자동 캡처해 정확한 리셋 시각을 사용.

## 요구사항
- 메뉴바 표시 형식 예: `CC 100% · 01:23` (사용률 · 남은 시간)
- 클릭 시 팝오버에 상세 정보(현재 세션/주간 리셋 시각, 계정/모델).
- 최소 60초 주기 자동 갱신 + 수동 새로고침.
- 오류/타임아웃 시 상태 아이콘 경고 표시.

## 아키텍처 개요
- **Collector**: `/status` PTY 자동 입력 → Usage 탭의 “Resets … (Asia/Seoul)” 파싱 → 사용률/리셋 시각 추출.
- **Parser**: 텍스트에서 `Current session`, `Current week` 블록 분리 후 리셋 시각/사용률 파싱.
- **State Store**: 최신 상태를 메모리에 유지, 실패 시 마지막 정상값 유지.
- **UI**: NSStatusItem + SwiftUI Popover.

## 구현 단계
### 1) 데이터 수집 모듈 고도화
- `capture-status.py`의 파싱 결과를 구조화(JSON).
- 리셋 시각을 “현재 시각 기준 카운트다운”으로 변환.
- 에러 상태 정의(타임아웃/파싱 실패/로그인 필요).

### 2) 메뉴바 앱 스켈레톤
- SwiftUI 앱 생성 + `NSStatusItem` 연결.
- 메뉴바 텍스트 업데이트 타이머(60초).
- 팝오버에 상세 정보 표시.

### 3) 데이터 연동
- 앱에서 수집 모듈 실행(서브프로세스 호출).
- JSON 결과 파싱 후 UI 반영.
- 실패 시 회색 아이콘 + “업데이트 실패” 표시.

### 4) 안정화
- 실행 시간 제한/재시도 로직 추가.
- 앱 시작 시 자동 실행(launchd).
- 로깅(간단 파일 로그) 추가.

## 검증 체크리스트
- 메뉴바 텍스트가 60초 주기로 업데이트됨.
- `/status` 결과가 바뀌면 2분 내 UI 반영됨.
- `/status` 실패 시 앱이 멈추지 않고 경고 상태로 전환됨.
